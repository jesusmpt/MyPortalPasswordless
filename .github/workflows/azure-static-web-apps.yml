{
  "navigationFallback": {
    "rewrite": "/index.html",
    "exclude": ["/api/*","/.auth/*"]
  },
  "auth": {
    "identityProviders": {
      "azureActiveDirectory": {
        "registration": {
          "openIdIssuer": "https://login.microsoftonline.com/9ff87f7c-8358-46b5-88bc-d73c09ce789f",
          "clientIdSettingName": "AZURE_CLIENT_ID"
        }
      }
    }
  },
  "routes": [
    { "route": "/", "allowedRoles":["authenticated"] },
    { "route": "/api/*", "allowedRoles":["authenticated"] },
    { "route": "/login", "redirect": "/.auth/login/aad", "statusCode":302 },
    { "route": "/logout", "redirect": "/.auth/logout", "statusCode":302 }
  ],
  "responseOverrides": {
    "401": { "redirect": "/login", "statusCode":302 }
  }
}
"@
Set-Content -Path "$root\staticwebapp.config.json" -Value $staticConfig

# ---------- GITHUB ACTIONS WORKFLOW ----------

$workflow = @"
name: Azure Static Web Apps CI/CD

on:
  push:
    branches:
      - main

jobs:
  build_and_deploy_job:
    runs-on: ubuntu-latest
    name: Build and Deploy

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        working-directory: ./frontend
        run: npm install

      - name: Build frontend
        working-directory: ./frontend
        run: npm run build

      - name: Deploy to Azure Static Web Apps
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_WITTY_SEA_04D5CEA03 }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          action: "upload"
          app_location: "frontend"
          output_location: "dist"
          api_location: "api"